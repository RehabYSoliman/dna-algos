{
    "collab_server" : "",
    "contents" : "\n#biocLite(\"AnnotationHub\")\n\nlibrary(AnnotationHub)\nah=AnnotationHub()\n\nah[1] #look at first object\n\n#ah[[1]] # DONT DO, download the entire first object\nunique(ah$dataprovider)\nunique(ah$species)\n\nah2 <- subset(ah,species == \"Homo sapiens\")\nstr(ah2)\nquery(ah2,\"H3K4me3\")\nah3 <- display(ah2)\n\n\n\nqhs <- query(ah2,c(\"H3K4me3\",\"Gm12878\"))\ndisplay(qhs)\n\ngr1 <- qhs[[\"AH27075\"]]\ngr2 <- qhs[[\"AH27077\"]]\nsummary(width(gr1))\ntable(width(gr2))\npeaks <- gr2\nrm(gr1);rm(gr2);\n\nq3 <- query(ah2,\"RefSeq\")\nq3\nq3$genome\n#biocLite(\"rtracklayer\")\ngenes=q3[[1]]\ntable(genes$name)\ntable(table(genes$name))\nprom <- promoters(genes)\ntable(width(prom))\n\n\n\nolaps <- findOverlaps(prom,peaks)\nlength(unique(queryHits(olaps)))\nlength(unique(subjectHits(olaps)))\nlength(subsetByOverlaps(peaks,prom,ignore.strand=T))\nlength(subsetByOverlaps(peaks,prom,ignore.strand=T))/length(peaks)\nlength(subsetByOverlaps(prom,peaks,ignore.strand=T))/length(prom)\nsum(width(reduce(peaks,ignore.strand=T)))\nsum(width(reduce(peaks,ignore.strand=T)))/10^6\nsum(width(reduce(prom,ignore.strand=T)))/10^6\nsum(width(intersect(peaks,prom,ignore.strand=T)))/10^6\n\n\n\ninout <- matrix(0,nrow=2,ncol=2)\ncolnames(inout) <- c(\"promin\",\"promout\")\nrownames(inout) <- c(\"peakin\",\"peakout\")\ninout[1,1] <- sum(width(intersect(peaks,prom,ignore.strand=T)))\ninout[1,2] <- sum(width(setdiff(peaks,prom,ignore.strand=T)))\ninout[2,1] <- sum(width(setdiff(prom,peaks,ignore.strand=T)))\ninout[2,2] <- 3*10^9-sum(inout)\ninout\ncolSums(inout)\nrowSums(inout)\nfisher.test(inout)$statistic\noddsratio <- inout[1,1]*inout[2,2]/(inout[2,1]*inout[1,2])\noddsratio\n\n\n\n\n\n\nq1 <- query(ah2,c(\"CpG Islands\"))\ngr1 <- q1[[1]]\ndropSeqlevels(gr1,\"chr23\")\nkeepSeqlevels(gr1,\"chr4\")\nkeepSeqlevels(gr1,c(\"chr1\",\"chr2\",\"chr3\",\"chr4\",\n                    \"chr5\",\"chr6\",\"chr7\",\"chr8\",\"chr9\",\"chr10\",\n                    \"chr11\",\"chr12\",\"chr13\",\"chr14\",\"chr15\",\"chr16\",\"chr17\",\n                    \"chr18\",\"chr19\",\"chr20\",\"chr21\",\"chr22\"))\ngr1 <- subset(gr1, seqnames %in% names(table(seqnames(gr1))[1:22]))\n\n\n\n\n\nq2 <- query(ah2,c(\"H3K4me3\",\"H1\",\"BroadInstitute\"))\ndisplay(q2)\nbpeaks <- q2[[\"AH28880\"]]\nbpeaks <- subset(bpeaks, seqnames %in% names(table(seqnames(bpeaks))[1:22]))\nsum(width(reduce(bpeaks,ignore.strand=T)))\nnpeaks <- q2[[\"AH29884\"]]\nnpeaks <- subset(npeaks, seqnames %in% names(table(seqnames(npeaks))[1:22]))\nsum(width(reduce(npeaks,ignore.strand=T)))\nmean(npeaks$signalValue)\n\nq2 <- query(ah2,c(\"H3K27me3\",\"H1\",\"BroadInstitute\"))\nnpeak2 <- q2[[\"AH29892\"]]\nnpeak2 <- subset(npeak2, seqnames %in% names(table(seqnames(npeak2))[1:22]))\nmean(npeak2$signalValue)\n\n\nsum(width(intersect(npeaks,npeak2,ignore.strand=T)))\n\n\nbivalent <- intersect(npeaks,npeak2,ignore.strand=T)\nlength(unique(queryHits(findOverlaps(bivalent,gr1))))/length(bivalent)\n\nsum(width(intersect(gr1,intersect(npeaks,npeak2,ignore.strand=T),ignore.strand=T))) / sum(width(reduce(gr1)))\nsum(width(intersect(gr1,bivalent,ignore.strand=T))) / sum(width(reduce(gr1)))\n\n\nsum(width(intersect(bivalent,resize(gr1,width=2*10^4,fix=\"center\"),ignore.strand=T)))\nsum(width(intersect(bivalent,resize(gr1,width(gr1)+2*10^4,fix=\"center\"),ignore.strand=T)))\n\n\nsum(width(reduce(gr1)))/sum(as.numeric(seqlengths(gr1)))\nsum(width(reduce(gr1)))/sum(as.numeric(seqlengths(gr1)[1:22]))\n\n\noddmat <- matrix(0,nrow=2,ncol=2)\ncolnames(oddmat) <- c(\"bivin\",\"bivout\")\nrownames(oddmat) <- c(\"cpgin\",\"cpgout\")\noddmat[1,1] <- sum(width(intersect(bivalent,gr1,ignore.strand=T)))\noddmat[1,2] <- sum(width(setdiff(bivalent,gr1,ignore.strand=T)))\noddmat[2,1] <- sum(width(setdiff(gr1,bivalent,ignore.strand=T)))\noddmat[2,2] <- sum(as.numeric(seqlengths(gr1)[1:22]))-sum(oddmat)\noddmat\ncolSums(oddmat)\nrowSums(oddmat)\n#fisher.test(inout)$statistic\noddsratio <- oddmat[1,1]*oddmat[2,2]/(oddmat[2,1]*oddmat[1,2])\noddsratio\n",
    "created" : 1465818433830.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3824027709",
    "id" : "629C0C74",
    "lastKnownWriteTime" : 1465844407,
    "last_content_update" : 1465844407628,
    "path" : "C:/Users/Rahul/PycharmProjects/dnaalgos/Bioconductor/AnnotationHubsample.R",
    "project_path" : "AnnotationHubsample.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}